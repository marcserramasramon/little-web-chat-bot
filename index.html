<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xat IntelÂ·ligent</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .animate-bounce {
            animation: bounce 0.6s infinite;
        }
        .contact-button {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            text-decoration: none;
            display: inline-block;
            margin-top: 10px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        .contact-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        function ChatApp() {
            const [messages, setMessages] = useState([
                { 
                    id: 1, 
                    text: "Hola! ðŸ‘‹ SÃ³c l'assistent virtual. Estic aquÃ­ per ajudar-te amb les teves preguntes. Com et puc ajudar avui?", 
                    sender: "bot", 
                    time: new Date().toLocaleTimeString('ca-ES', { hour: '2-digit', minute: '2-digit' }) 
                }
            ]);
            const [newMessage, setNewMessage] = useState("");
            const [isLoading, setIsLoading] = useState(false);
            const [conversationCount, setConversationCount] = useState(0);
            const messagesEndRef = useRef(null);

            // CONFIGURA AQUÃ EL TEU EMAIL I INFO DE CONTACTE
            const CONTACT_EMAIL = "marcserramasramon@gmail.com";
            const CONTACT_PHONE = "+34 656 707 404";
            const CALENDLY_LINK = "https://calendar.app.google/duXdRydWAwKXxVhZA"; // Opcional: enllaÃ§ a Calendly

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            // System prompt que fa que Claude sempre dirigeixi a contacte
            const SYSTEM_INSTRUCTION = `Ets un assistent virtual d'una empresa. El teu objectiu Ã©s:

1. Respondre preguntes de manera Ãºtil i professional
2. Demostrar coneixement i competÃ¨ncia
3. SEMPRE acabar oferint contactar directament per mÃ©s detalls o per continuar la conversa

EstratÃ¨gia de resposta:
- Respon la pregunta de manera concisa perÃ² Ãºtil (2-3 frases mÃ xim)
- DesprÃ©s d'explicar, SEMPRE afegeix una invitaciÃ³ a contactar directament
- Varia les teves invitacions de contacte: "Vols que parlem mÃ©s detalls?", "T'agradaria que et contactÃ©s?", "Preferiries una conversa personalitzada?", etc.
- Sigues cÃ lid, proper i professional
- Si la pregunta Ã©s sobre preus, disponibilitat o serveis especÃ­fics, digues que aixÃ² es pot parlar millor directament

IMPORTANT: 
- No donis mai informaciÃ³ completa que elimini la necessitat de contactar
- Sempre crea curiositat o ofereix mÃ©s valor en una conversa directa
- DesprÃ©s de 2-3 missatges, incrementa la urgÃ¨ncia: "M'encantaria poder ajudar-te millor. Tens 5 minuts per una trucada rÃ pida?"

Respon SEMPRE en catalÃ .`;

            const addContactPrompt = (userMessage, responseText) => {
                // Afegeix botÃ³ de contacte desprÃ©s de cada resposta del bot
                const hasContactButton = responseText.includes('ðŸ“ž') || responseText.includes('ðŸ“§');
                
                if (!hasContactButton && conversationCount >= 1) {
                    return responseText + "\n\nðŸ“ž Vols que parlem mÃ©s detalladament? Estic disponible per ajudar-te personalment.";
                }
                return responseText;
            };

            const handleSend = async () => {
                if (newMessage.trim() && !isLoading) {
                    const userMsg = {
                        id: messages.length + 1,
                        text: newMessage,
                        sender: "user",
                        time: new Date().toLocaleTimeString('ca-ES', { hour: '2-digit', minute: '2-digit' })
                    };
                    
                    setMessages(prev => [...prev, userMsg]);
                    const messageToSend = newMessage;
                    setNewMessage("");
                    setIsLoading(true);
                    setConversationCount(prev => prev + 1);

                    try {
                        const response = await fetch("https://api.anthropic.com/v1/messages", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({
                                model: "claude-sonnet-4-20250514",
                                max_tokens: 500,
                                system: SYSTEM_INSTRUCTION,
                                messages: [
                                    { role: "user", content: messageToSend }
                                ],
                            })
                        });

                        const data = await response.json();
                        let botResponse = data.content?.find(item => item.type === "text")?.text || "Ho sento, no he pogut processar la resposta.";

                        // Afegeix sempre invitaciÃ³ a contactar
                        botResponse = addContactPrompt(messageToSend, botResponse);

                        const botMsg = {
                            id: Date.now(),
                            text: botResponse,
                            sender: "bot",
                            time: new Date().toLocaleTimeString('ca-ES', { hour: '2-digit', minute: '2-digit' }),
                            showContactButtons: conversationCount >= 1 // Mostra botons desprÃ©s del primer intercanvi
                        };

                        setMessages(prev => [...prev, botMsg]);

                        // DesprÃ©s de 3 intercanvis, mostra un missatge proactiu
                        if (conversationCount === 2) {
                            setTimeout(() => {
                                const proactiveMsg = {
                                    id: Date.now() + 1,
                                    text: "Veig que tens interÃ¨s en el que fem! ðŸŽ¯\n\nT'agradaria una demostraciÃ³ personalitzada o parlar dels teus objectius especÃ­fics? Puc reservar-te 15 minuts aquesta setmana.",
                                    sender: "bot",
                                    time: new Date().toLocaleTimeString('ca-ES', { hour: '2-digit', minute: '2-digit' }),
                                    showContactButtons: true,
                                    urgent: true
                                };
                                setMessages(prev => [...prev, proactiveMsg]);
                            }, 2000);
                        }

                    } catch (error) {
                        console.error("Error:", error);
                        const errorMsg = {
                            id: Date.now(),
                            text: "Ho sento, hi ha hagut un error. Per continuar, pots contactar-me directament i t'ajudarÃ© personalment! ðŸ˜Š",
                            sender: "bot",
                            time: new Date().toLocaleTimeString('ca-ES', { hour: '2-digit', minute: '2-digit' }),
                            showContactButtons: true
                        };
                        setMessages(prev => [...prev, errorMsg]);
                    } finally {
                        setIsLoading(false);
                    }
                }
            };

            const ContactButtons = () => (
                <div style={{ marginTop: '12px', display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                    <a 
                        href={`mailto:${CONTACT_EMAIL}?subject=Consulta des del xat`}
                        className="contact-button"
                        style={{ fontSize: '0.85rem', padding: '8px 16px' }}
                    >
                        ðŸ“§ Enviar Email
                    </a>
                    <a 
                        href={`tel:${CONTACT_PHONE.replace(/\s/g, '')}`}
                        className="contact-button"
                        style={{ fontSize: '0.85rem', padding: '8px 16px' }}
                    >
                        ðŸ“ž Trucar Ara
                    </a>
                    {CALENDLY_LINK && (
                        <a 
                            href={CALENDLY_LINK}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="contact-button"
                            style={{ fontSize: '0.85rem', padding: '8px 16px' }}
                        >
                            ðŸ“… Reservar Cita
                        </a>
                    )}
                </div>
            );

            const BotIcon = () => (
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <rect x="3" y="11" width="18" height="10" rx="2"/>
                    <circle cx="12" cy="5" r="2"/>
                    <path d="M12 7v4"/>
                    <line x1="8" y1="16" x2="8" y2="16"/>
                    <line x1="16" y1="16" x2="16" y2="16"/>
                </svg>
            );

            const UserIcon = () => (
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
            );

            const SendIcon = () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <line x1="22" y1="2" x2="11" y2="13"/>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                </svg>
            );

            return (
                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', minHeight: '100vh', background: 'linear-gradient(to bottom right, #f8fafc, #f1f5f9)', padding: '1rem' }}>
                    <div style={{ width: '100%', maxWidth: '48rem', backgroundColor: 'white', borderRadius: '1rem', boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.25)', overflow: 'hidden', border: '1px solid #e2e8f0' }}>
                        {/* Header */}
                        <div style={{ background: 'linear-gradient(to right, #4f46e5, #7c3aed)', color: 'white', padding: '1.25rem' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
                                <div style={{ backgroundColor: 'rgba(255, 255, 255, 0.2)', padding: '0.5rem', borderRadius: '9999px' }}>
                                    <BotIcon />
                                </div>
                                <div>
                                    <h2 style={{ fontSize: '1.25rem', fontWeight: 'bold', margin: 0 }}>Assistent Virtual</h2>
                                    <p style={{ fontSize: '0.875rem', color: '#c7d2fe', margin: 0 }}>En lÃ­nia Â· Resposta en segons</p>
                                </div>
                            </div>
                        </div>

                        {/* Messages Container */}
                        <div style={{ height: '500px', overflowY: 'auto', padding: '1.25rem', background: '#f8fafc' }}>
                            {messages.map((msg) => (
                                <div
                                    key={msg.id}
                                    style={{ 
                                        display: 'flex', 
                                        gap: '0.75rem', 
                                        flexDirection: msg.sender === 'user' ? 'row-reverse' : 'row',
                                        marginBottom: '1rem'
                                    }}
                                >
                                    {/* Avatar */}
                                    <div style={{ 
                                        flexShrink: 0, 
                                        width: '2rem', 
                                        height: '2rem', 
                                        borderRadius: '9999px', 
                                        display: 'flex', 
                                        alignItems: 'center', 
                                        justifyContent: 'center',
                                        background: msg.sender === 'user' 
                                            ? 'linear-gradient(to bottom right, #3b82f6, #4f46e5)' 
                                            : 'linear-gradient(to bottom right, #a855f7, #4f46e5)',
                                        color: 'white'
                                    }}>
                                        {msg.sender === 'user' ? <UserIcon /> : <BotIcon />}
                                    </div>

                                    {/* Message Bubble */}
                                    <div style={{ 
                                        display: 'flex', 
                                        flexDirection: 'column', 
                                        maxWidth: '70%',
                                        alignItems: msg.sender === 'user' ? 'flex-end' : 'flex-start'
                                    }}>
                                        <div style={{
                                            padding: '0.75rem 1rem',
                                            borderRadius: '1rem',
                                            boxShadow: msg.urgent ? '0 0 20px rgba(16, 185, 129, 0.3)' : '0 1px 2px 0 rgba(0, 0, 0, 0.05)',
                                            background: msg.sender === 'user'
                                                ? 'linear-gradient(to right, #3b82f6, #4f46e5)'
                                                : msg.urgent 
                                                    ? 'linear-gradient(135deg, #10b981, #059669)'
                                                    : 'white',
                                            color: msg.sender === 'user' || msg.urgent ? 'white' : '#1f2937',
                                            border: (msg.sender === 'user' || msg.urgent) ? 'none' : '1px solid #e2e8f0',
                                            borderBottomRightRadius: msg.sender === 'user' ? '0.25rem' : '1rem',
                                            borderBottomLeftRadius: msg.sender === 'user' ? '1rem' : '0.25rem'
                                        }}>
                                            <p style={{ fontSize: '0.875rem', lineHeight: '1.5', margin: 0, whiteSpace: 'pre-wrap' }}>{msg.text}</p>
                                            {msg.showContactButtons && msg.sender === 'bot' && <ContactButtons />}
                                        </div>
                                        <p style={{ fontSize: '0.75rem', color: '#64748b', marginTop: '0.25rem', paddingLeft: '0.5rem', paddingRight: '0.5rem' }}>
                                            {msg.time}
                                        </p>
                                    </div>
                                </div>
                            ))}
                            
                            {isLoading && (
                                <div style={{ display: 'flex', gap: '0.75rem', marginBottom: '1rem' }}>
                                    <div style={{ 
                                        flexShrink: 0, 
                                        width: '2rem', 
                                        height: '2rem', 
                                        borderRadius: '9999px',
                                        background: 'linear-gradient(to bottom right, #a855f7, #4f46e5)',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        color: 'white'
                                    }}>
                                        <BotIcon />
                                    </div>
                                    <div style={{ 
                                        backgroundColor: 'white', 
                                        color: '#1f2937', 
                                        padding: '0.75rem 1rem', 
                                        borderRadius: '1rem',
                                        borderBottomLeftRadius: '0.25rem',
                                        border: '1px solid #e2e8f0',
                                        boxShadow: '0 1px 2px 0 rgba(0, 0, 0, 0.05)'
                                    }}>
                                        <div style={{ display: 'flex', gap: '0.25rem' }}>
                                            <div className="animate-bounce" style={{ width: '0.5rem', height: '0.5rem', backgroundColor: '#9ca3af', borderRadius: '9999px', animationDelay: '0ms' }}></div>
                                            <div className="animate-bounce" style={{ width: '0.5rem', height: '0.5rem', backgroundColor: '#9ca3af', borderRadius: '9999px', animationDelay: '150ms' }}></div>
                                            <div className="animate-bounce" style={{ width: '0.5rem', height: '0.5rem', backgroundColor: '#9ca3af', borderRadius: '9999px', animationDelay: '300ms' }}></div>
                                        </div>
                                    </div>
                                </div>
                            )}
                            
                            <div ref={messagesEndRef} />
                        </div>

                        {/* Input Area */}
                        <div style={{ padding: '1rem', backgroundColor: 'white', borderTop: '1px solid #e2e8f0' }}>
                            <div style={{ display: 'flex', gap: '0.5rem' }}>
                                <input
                                    type="text"
                                    value={newMessage}
                                    onChange={(e) => setNewMessage(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && !isLoading && handleSend()}
                                    placeholder="Escriu la teva pregunta..."
                                    disabled={isLoading}
                                    style={{
                                        flex: 1,
                                        padding: '0.75rem 1rem',
                                        border: '1px solid #cbd5e1',
                                        borderRadius: '9999px',
                                        outline: 'none',
                                        fontSize: '0.875rem'
                                    }}
                                />
                                <button
                                    onClick={handleSend}
                                    disabled={isLoading || !newMessage.trim()}
                                    style={{
                                        background: 'linear-gradient(to right, #4f46e5, #7c3aed)',
                                        color: 'white',
                                        padding: '0.75rem',
                                        borderRadius: '9999px',
                                        border: 'none',
                                        cursor: isLoading || !newMessage.trim() ? 'not-allowed' : 'pointer',
                                        opacity: isLoading || !newMessage.trim() ? 0.5 : 1,
                                        boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)',
                                        transition: 'all 0.2s'
                                    }}
                                >
                                    <SendIcon />
                                </button>
                            </div>
                            <p style={{ fontSize: '0.75rem', color: '#64748b', marginTop: '0.5rem', textAlign: 'center' }}>
                                Pressioneu Enter per enviar Â· 100% privat i segur
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<ChatApp />, document.getElementById('root'));
    </script>
</body>
</html>
