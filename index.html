<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xat Intel·ligent</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .animate-bounce {
            animation: bounce 0.6s infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        function ChatApp() {
            const [messages, setMessages] = useState([
                { 
                    id: 1, 
                    text: "Hola! Sóc el teu assistent. En què et puc ajudar?", 
                    sender: "bot", 
                    time: new Date().toLocaleTimeString('ca-ES', { hour: '2-digit', minute: '2-digit' }) 
                }
            ]);
            const [newMessage, setNewMessage] = useState("");
            const [isLoading, setIsLoading] = useState(false);
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            const handleSend = async () => {
                if (newMessage.trim() && !isLoading) {
                    const userMsg = {
                        id: messages.length + 1,
                        text: newMessage,
                        sender: "user",
                        time: new Date().toLocaleTimeString('ca-ES', { hour: '2-digit', minute: '2-digit' })
                    };
                    
                    setMessages(prev => [...prev, userMsg]);
                    const messageToSend = newMessage;
                    setNewMessage("");
                    setIsLoading(true);

                    try {
                        const response = await fetch("https://api.anthropic.com/v1/messages", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({
                                model: "claude-sonnet-4-20250514",
                                max_tokens: 1000,
                                messages: [
                                    { role: "user", content: messageToSend }
                                ],
                            })
                        });

                        const data = await response.json();
                        const botResponse = data.content?.find(item => item.type === "text")?.text || "Ho sento, no he pogut processar la resposta.";

                        const botMsg = {
                            id: Date.now(),
                            text: botResponse,
                            sender: "bot",
                            time: new Date().toLocaleTimeString('ca-ES', { hour: '2-digit', minute: '2-digit' })
                        };

                        setMessages(prev => [...prev, botMsg]);
                    } catch (error) {
                        console.error("Error:", error);
                        const errorMsg = {
                            id: Date.now(),
                            text: "Ho sento, hi ha hagut un error. Torna-ho a provar.",
                            sender: "bot",
                            time: new Date().toLocaleTimeString('ca-ES', { hour: '2-digit', minute: '2-digit' })
                        };
                        setMessages(prev => [...prev, errorMsg]);
                    } finally {
                        setIsLoading(false);
                    }
                }
            };

            const BotIcon = () => (
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <rect x="3" y="11" width="18" height="10" rx="2"/>
                    <circle cx="12" cy="5" r="2"/>
                    <path d="M12 7v4"/>
                    <line x1="8" y1="16" x2="8" y2="16"/>
                    <line x1="16" y1="16" x2="16" y2="16"/>
                </svg>
            );

            const UserIcon = () => (
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
            );

            const SendIcon = () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <line x1="22" y1="2" x2="11" y2="13"/>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                </svg>
            );

            return (
                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', minHeight: '100vh', background: 'linear-gradient(to bottom right, #f8fafc, #f1f5f9)', padding: '1rem' }}>
                    <div style={{ width: '100%', maxWidth: '48rem', backgroundColor: 'white', borderRadius: '1rem', boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.25)', overflow: 'hidden', border: '1px solid #e2e8f0' }}>
                        {/* Header */}
                        <div style={{ background: 'linear-gradient(to right, #4f46e5, #7c3aed)', color: 'white', padding: '1.25rem' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
                                <div style={{ backgroundColor: 'rgba(255, 255, 255, 0.2)', padding: '0.5rem', borderRadius: '9999px' }}>
                                    <BotIcon />
                                </div>
                                <div>
                                    <h2 style={{ fontSize: '1.25rem', fontWeight: 'bold', margin: 0 }}>Assistent Intel·ligent</h2>
                                    <p style={{ fontSize: '0.875rem', color: '#c7d2fe', margin: 0 }}>Sempre disponible per ajudar-te</p>
                                </div>
                            </div>
                        </div>

                        {/* Messages Container */}
                        <div style={{ height: '500px', overflowY: 'auto', padding: '1.25rem', background: '#f8fafc' }}>
                            {messages.map((msg) => (
                                <div
                                    key={msg.id}
                                    style={{ 
                                        display: 'flex', 
                                        gap: '0.75rem', 
                                        flexDirection: msg.sender === 'user' ? 'row-reverse' : 'row',
                                        marginBottom: '1rem'
                                    }}
                                >
                                    {/* Avatar */}
                                    <div style={{ 
                                        flexShrink: 0, 
                                        width: '2rem', 
                                        height: '2rem', 
                                        borderRadius: '9999px', 
                                        display: 'flex', 
                                        alignItems: 'center', 
                                        justifyContent: 'center',
                                        background: msg.sender === 'user' 
                                            ? 'linear-gradient(to bottom right, #3b82f6, #4f46e5)' 
                                            : 'linear-gradient(to bottom right, #a855f7, #4f46e5)',
                                        color: 'white'
                                    }}>
                                        {msg.sender === 'user' ? <UserIcon /> : <BotIcon />}
                                    </div>

                                    {/* Message Bubble */}
                                    <div style={{ 
                                        display: 'flex', 
                                        flexDirection: 'column', 
                                        maxWidth: '70%',
                                        alignItems: msg.sender === 'user' ? 'flex-end' : 'flex-start'
                                    }}>
                                        <div style={{
                                            padding: '0.75rem 1rem',
                                            borderRadius: '1rem',
                                            boxShadow: '0 1px 2px 0 rgba(0, 0, 0, 0.05)',
                                            background: msg.sender === 'user'
                                                ? 'linear-gradient(to right, #3b82f6, #4f46e5)'
                                                : 'white',
                                            color: msg.sender === 'user' ? 'white' : '#1f2937',
                                            border: msg.sender === 'user' ? 'none' : '1px solid #e2e8f0',
                                            borderBottomRightRadius: msg.sender === 'user' ? '0.25rem' : '1rem',
                                            borderBottomLeftRadius: msg.sender === 'user' ? '1rem' : '0.25rem'
                                        }}>
                                            <p style={{ fontSize: '0.875rem', lineHeight: '1.5', margin: 0, whiteSpace: 'pre-wrap' }}>{msg.text}</p>
                                        </div>
                                        <p style={{ fontSize: '0.75rem', color: '#64748b', marginTop: '0.25rem', paddingLeft: '0.5rem', paddingRight: '0.5rem' }}>
                                            {msg.time}
                                        </p>
                                    </div>
                                </div>
                            ))}
                            
                            {isLoading && (
                                <div style={{ display: 'flex', gap: '0.75rem', marginBottom: '1rem' }}>
                                    <div style={{ 
                                        flexShrink: 0, 
                                        width: '2rem', 
                                        height: '2rem', 
                                        borderRadius: '9999px',
                                        background: 'linear-gradient(to bottom right, #a855f7, #4f46e5)',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        color: 'white'
                                    }}>
                                        <BotIcon />
                                    </div>
                                    <div style={{ 
                                        backgroundColor: 'white', 
                                        color: '#1f2937', 
                                        padding: '0.75rem 1rem', 
                                        borderRadius: '1rem',
                                        borderBottomLeftRadius: '0.25rem',
                                        border: '1px solid #e2e8f0',
                                        boxShadow: '0 1px 2px 0 rgba(0, 0, 0, 0.05)'
                                    }}>
                                        <div style={{ display: 'flex', gap: '0.25rem' }}>
                                            <div className="animate-bounce" style={{ width: '0.5rem', height: '0.5rem', backgroundColor: '#9ca3af', borderRadius: '9999px', animationDelay: '0ms' }}></div>
                                            <div className="animate-bounce" style={{ width: '0.5rem', height: '0.5rem', backgroundColor: '#9ca3af', borderRadius: '9999px', animationDelay: '150ms' }}></div>
                                            <div className="animate-bounce" style={{ width: '0.5rem', height: '0.5rem', backgroundColor: '#9ca3af', borderRadius: '9999px', animationDelay: '300ms' }}></div>
                                        </div>
                                    </div>
                                </div>
                            )}
                            
                            <div ref={messagesEndRef} />
                        </div>

                        {/* Input Area */}
                        <div style={{ padding: '1rem', backgroundColor: 'white', borderTop: '1px solid #e2e8f0' }}>
                            <div style={{ display: 'flex', gap: '0.5rem' }}>
                                <input
                                    type="text"
                                    value={newMessage}
                                    onChange={(e) => setNewMessage(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && !isLoading && handleSend()}
                                    placeholder="Escriu el teu missatge..."
                                    disabled={isLoading}
                                    style={{
                                        flex: 1,
                                        padding: '0.75rem 1rem',
                                        border: '1px solid #cbd5e1',
                                        borderRadius: '9999px',
                                        outline: 'none',
                                        fontSize: '0.875rem'
                                    }}
                                />
                                <button
                                    onClick={handleSend}
                                    disabled={isLoading || !newMessage.trim()}
                                    style={{
                                        background: 'linear-gradient(to right, #4f46e5, #7c3aed)',
                                        color: 'white',
                                        padding: '0.75rem',
                                        borderRadius: '9999px',
                                        border: 'none',
                                        cursor: isLoading || !newMessage.trim() ? 'not-allowed' : 'pointer',
                                        opacity: isLoading || !newMessage.trim() ? 0.5 : 1,
                                        boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)',
                                        transition: 'all 0.2s'
                                    }}
                                >
                                    <SendIcon />
                                </button>
                            </div>
                            <p style={{ fontSize: '0.75rem', color: '#64748b', marginTop: '0.5rem', textAlign: 'center' }}>
                                Pressioneu Enter per enviar
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<ChatApp />, document.getElementById('root'));
    </script>
</body>
</html>
